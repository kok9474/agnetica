<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¯¼ì› ì²˜ë¦¬ ë°ëª¨</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    textarea { width: 100%; }
    pre { background: #f4f4f4; padding: .5rem; }
  </style>
</head>
<body>
  <h1>ë¯¼ì› ì²˜ë¦¬ ë°ëª¨</h1>
  <form id="complaintForm">
    <label>ì´ë¯¸ì§€ ì—…ë¡œë“œ:
      <input type="file" id="fileInput" accept="image/*" required>
    </label><br><br>
    <label>ë¯¼ì› í…ìŠ¤íŠ¸:
      <textarea id="textInput" rows="4" placeholder="ë¯¼ì› ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
    </label><br>
    <button type="submit">ì „ì†¡</button>
  </form>

  <h2>ê²°ê³¼</h2>
  <pre id="result">ì•„ì§ ì „ì†¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</pre>

  <script>
  document.getElementById("complaintForm").addEventListener("submit", async e => {
    e.preventDefault();
    const file = document.getElementById("fileInput").files[0];
    const rawText = document.getElementById("textInput").value;
    const resultEl = document.getElementById("result");
    resultEl.textContent = "ì²˜ë¦¬ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";

    try {
      // 1) Vision API í˜¸ì¶œ
      const formData = new FormData();
      formData.append("file", file);
      const visionResp = await fetch("/vision/analyze", {
        method: "POST",
        body: formData
      });
      const visionJson = await visionResp.json();
      console.log("Vision:", visionJson);

      // ë°±ì—”ë“œ-í”„ëŸ°íŠ¸ í‚¤ ë³´ì •
      const ocr = visionJson.ocr_text ?? visionJson.ocr ?? "";

      // 2) Text ë³€í™˜ API í˜¸ì¶œ
      const textResp = await fetch("http://localhost:9000/text/transform", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          rawText: rawText,
        })
      });
      const textJson = await textResp.json();
      console.log("TextTransform:", textJson);

      // 3) ê²°ê³¼ í™”ë©´ì— ê·¸ë¦¬ê¸°
      resultEl.textContent = 
        `âœ¨ OCR í…ìŠ¤íŠ¸: ${visionJson.ocr}\n` 
        //`âœ¨ ë¶„ë¥˜(ì¹´í…Œê³ ë¦¬): ${visionJson.category}\n\n` +
         `ğŸ“‹ ê²©ì–´ì²´ ë³€í™˜:\n${textJson.formalText}`;
    } catch (err) {
      console.error(err);
      resultEl.textContent = "ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.";
    }
  });
  </script>
</body>
</html>